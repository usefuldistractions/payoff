"use strict";!function(e){var t=0<arguments.length&&void 0!==e?e:window;return void 0!==t.define?t.define("Payoff",r):t.Payoff=r;function r(e){function n(){var e=B,t=e.startMonth,r=e.startYear,n=e.duration,a=e.amount,o=e.rate/12,i=1+o,f=Math.pow(i,n),u=a*(o*f/(f-1));u=G(u,2);for(var d=0,c=0,p=0,h=a,y=[],m=0;m<=n;m++){for(var v=new Date(r,t+m,1),s=v.getFullYear(),P=s.toString(),l=v.getMonth()+1,w=C(l,2),g=C(v.getDate(),2),b=0,M=0;M<A.length;M++){var E=A[M],Y=E.year,N=E.month,j=E.endYear,D=E.endMonth,k=E.recurring,S=!1;Y===s&&N===l?S=!0:k&&(Y<s||s===Y&&N<=l)&&("number"==typeof D&&"number"==typeof j?(s<j||s===j&&l<=D)&&(S=!0):S=!0),S&&(b+=E.amount)}var q=G(h*o,2),x=G(u-q+b,2);(h=G(h-x,2))<0&&(x+=h,h=0);var F=q+x;if(y.push({paid:F,year:s,month:l,principal:h,interestPaid:q,principalPaid:x,date:"".concat(P,"-").concat(w,"-").concat(g)}),d+=F,c+=q,p+=x,h<=0)break}var O=y[y.length-1];z.amount=G(a,2),z.interestPaid=G(c,2),z.monthlyPayment=G(u,2),z.paid=G(d,2),z.payoffDate=O.date,z.payoffMonth=O.month,z.payoffYear=O.year,z.principalPaid=G(p,2),z.startYear=r,z.startMonth=t,z.table=y}var z=this,A=[],B={},t=0;return Object.defineProperties(this,{update:{value:function(e){if("object"!=typeof B)throw new Error("setup object required");return B=e,n()}},addPayment:{value:function(e){if("number"!=typeof e.amount)throw new Error("Payoff.addPayment(): No amount specified");if("number"!=typeof e.month)throw new Error("Payoff.addPayment(): No month specified");if("number"!=typeof e.year)throw new Error("Payoff.addPayment(): No year specified");return e.index=t++,!0!==e.recurring&&(e.recurring=!1),A.push(e),n()}},removePayment:{value:function(e){if("number"!=typeof e.id)throw new Error("Payoff.removePayment(): No id specified");for(var t=0;t<A.length;t++){var r=A[t];if(r.id==r.id){A.splice(t,1);break}}return n()}}}),this.update(e)}function C(e,t){for(var r=Math.floor(e).toString(),n=t-r.length,a="",o=0;o<n;o++)a+="0";return"".concat(a).concat(r)}function G(e,t){var r=Math.pow(10,t),n=e*r;return Math.round(n)/r}}(void 0);