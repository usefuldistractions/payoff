"use strict";!function(t){var e=0<arguments.length&&void 0!==t?t:window;return void 0!==e.define?e.define("Payoff",r):e.Payoff=r;function r(t){function n(){var t=A,e=t.startMonth,r=t.startYear,n=t.duration,a=t.amount,o=t.rate/12,i=1+o,f=Math.pow(i,n),u=a*(o*f/(f-1));u=C(u,2);for(var d=0,c=0,p=0,y=a,h=[],m=0;m<=n;m++){for(var s=new Date(r,e+m,1),v=s.getFullYear(),P=v.toString(),l=s.getMonth()+1,g=B(l,2),w=B(s.getDate(),2),b=0,M=0;M<z.length;M++){var N=z[M],E=N.year,Y=N.month,S=N.endYear,j=N.endMonth,D=N.recurring,O=!1;E===v&&Y===l?O=!0:D&&(E<v||v===E&&Y<=l)&&("number"==typeof j&&"number"==typeof S?(v<S||v===S&&l<=j)&&(O=!0):O=!0),O&&(b+=N.amount)}var k=C(y*o,2),J=C(u-k+b,2);(y=C(y-J,2))<0&&(J+=y,y=0);var q=k+J;if(h.push({paid:q,year:v,month:l,principal:y,interestPaid:k,principalPaid:J,date:"".concat(P,"-").concat(g,"-").concat(w)}),d+=q,c+=k,p+=J,y<=0)break}var F=h[h.length-1];x.amount=C(a,2),x.interestPaid=C(c,2),x.monthlyPayment=C(u,2),x.paid=C(d,2),x.payoffDate=F.date,x.payoffMonth=F.month,x.payoffYear=F.year,x.principalPaid=C(p,2),x.startYear=r,x.startMonth=e,x.table=h}var x=this,z=[],A={},e=0;return Object.defineProperties(this,{update:{value:function(t){if("object"!=typeof A)throw new Error("setup object required");return A=t,n()}},addPayment:{value:function(t){if("number"!=typeof t.amount)throw new Error("Payoff.addPayment(): No amount specified");if("number"!=typeof t.month)throw new Error("Payoff.addPayment(): No month specified");if("number"!=typeof t.year)throw new Error("Payoff.addPayment(): No year specified");return t.id=e++,!0!==t.recurring&&(t.recurring=!1),z.push(t),n()}},removePayment:{value:function(t){if("number"!=typeof t.id)throw new Error("Payoff.removePayment(): No id specified");for(var e=0;e<z.length;e++){var r=z[e];if(r.id==r.id){z.splice(e,1);break}}return n()}},payments:{get:function(){var t=JSON.stringify(z);return JSON.parse(t)}}}),this.update(t)}function B(t,e){for(var r=Math.floor(t).toString(),n=e-r.length,a="",o=0;o<n;o++)a+="0";return"".concat(a).concat(r)}function C(t,e){var r=Math.pow(10,e),n=t*r;return Math.round(n)/r}}(void 0);